<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>API Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(120deg, #e0e7ff 0%, #f7f7f7 100%);
            margin: 0;
            padding: 0;
        }

        .chat-container {
            max-width: 540px;
            margin: 40px auto;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 4px 24px #b3b3b3;
            padding: 0 0 20px 0;
            overflow: hidden;
        }

        .chat-header {
            background: #1976d2;
            color: #fff;
            padding: 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .chat-history {
            height: 480px;
            overflow-y: auto;
            padding: 24px 20px 10px 20px;
            background: #f4f6fb;
        }

        .chat-msg {
            margin-bottom: 18px;
            display: flex;
            flex-direction: column;
        }

        .user-msg {
            align-items: flex-end;
        }

        .bot-msg {
            align-items: flex-start;
        }

        .user .bubble {
            background: #1976d2;
            color: #fff;
            border-radius: 16px 16px 4px 16px;
            padding: 10px 16px;
            max-width: 80%;
            font-size: 1em;
            margin-bottom: 2px;
        }

        .bot .bubble {
            background: #e3f2fd;
            color: #222;
            border-radius: 16px 16px 16px 4px;
            padding: 10px 16px;
            max-width: 80%;
            font-size: 1em;
            margin-bottom: 2px;
            border: 1px solid #bbdefb;
        }

        .sender-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 2px;
            margin-left: 4px;
        }

        .input-row {
            display: flex;
            padding: 16px 20px 0 20px;
            gap: 10px;
        }

        input[type=text] {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #bdbdbd;
            font-size: 1em;
            background: #f7f7f7;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: #1976d2;
            color: #fff;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:disabled {
            background: #aaa;
        }

        @media (max-width: 600px) {
            .chat-container {
                max-width: 100vw;
                margin: 0;
                border-radius: 0;
            }

            .chat-history {
                height: 60vh;
                padding: 12px 6px 6px 6px;
            }

            .input-row {
                padding: 10px 6px 0 6px;
            }
        }

        /* Markdown styles */
        .bot .bubble pre,
        .bot .bubble code {
            background: #263238;
            color: #fff;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 0.97em;
            overflow-x: auto;
        }

        .bot .bubble pre {
            margin: 8px 0;
        }

        .bot .bubble a {
            color: #1976d2;
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="chat-header">API Chatbot</div>
        <div class="chat-history" id="chatHistory"></div>
        <div class="input-row">
            <input type="text" id="userInput" placeholder="Ask about the API..." autocomplete="off" />
            <button id="sendBtn">Send</button>
        </div>
    </div>
    <script>
        const chatHistory = document.getElementById('chatHistory');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        function appendMessage(sender, text) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `chat-msg ${sender}-msg`;
            const label = `<div class="sender-label">${sender === 'user' ? 'You' : 'Bot'}</div>`;
            let bubbleContent;
            if (sender === 'bot') {
                // Render markdown for bot
                bubbleContent = `<div class="bubble">${marked.parse(text)}</div>`;
            } else {
                bubbleContent = `<div class="bubble">${text.replace(/\n/g, '<br>')}</div>`;
            }
            msgDiv.innerHTML = `<div class="${sender}">${label}${bubbleContent}</div>`;
            chatHistory.appendChild(msgDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        async function sendMessage() {
            const question = userInput.value.trim();
            if (!question) return;
            appendMessage('user', question);
            userInput.value = '';
            sendBtn.disabled = true;
            try {
                const res = await fetch('http://localhost:8100/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });
                const data = await res.json();
                appendMessage('bot', data.answer);
            } catch (e) {
                appendMessage('bot', 'Error contacting server.');
            }
            sendBtn.disabled = false;
        }

        sendBtn.onclick = sendMessage;
        userInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>

</html>